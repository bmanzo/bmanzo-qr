theme_classic(base_size=20)+
ylab('test set MSE')+
scale_colour_manual(name = 'mtry',
values =c(cbp1[c(3, 6)]), labels = c('1','2'))
ggsave('figs/rf_err_plot.png',
plot=rf_err_plot,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
# plot variable importance
rf_df = data.frame(rf$importance)
rf_df[order(rf_df$X.IncMSE, decreasing=T),]
rf_plot = ggplot(rf_df)+
geom_bar(aes(y=X.IncMSE, x=row.names(rf_df)), stat='identity', fill=cbp1[6])+
theme_classic(base_size=20)+
xlab('Variable')+
ylab('IncMSE')
ggsave('figs/rf_plot.png',
plot=rf_plot,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
rf3 <- randomForest(x=rf_data[-test_inds, -1], y=rf_data$deaths[-test_inds], importance=TRUE,
xtest=rf_data[test_inds, -1], ytest=rf_data$deaths[test_inds], keep.forest=TRUE,
ntree=500, mtry=4)
plot(rf3)
rf3$test$mse
mean(rf$test$mse)
rf_plot2_data = data.frame(trees=seq(1, 500), rf_1var = rf2$mse, rf_2var = rf$mse, rf_3var = rf3$mse)
rf_err_plot = ggplot(rf_plot2_data)+
geom_line(aes(x=trees, y=rf_1var, color=cbp1[3]))+
geom_line(aes(x=trees, y=rf_2var, color=cbp1[6]))+
geom_line(aes(x=trees, y=rf_2var, color=cbp1[8]))+
theme_classic(base_size=20)+
ylab('test set MSE')+
scale_colour_manual(name = 'mtry',
values =c(cbp1[c(3, 6, 8)]), labels = c('1','2', '3'))
rf_err_plot
ggsave('figs/rf_err_plot.png',
plot=rf_err_plot,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
rf_plot = ggplot(rf_df)+
geom_bar(aes(y=X.IncMSE, x=row.names(rf_df)), stat='identity', fill=cbp1[6])+
theme_classic(base_size=20)+
xlab('Variable')+
ylab('IncMSE')
rf_plot
?mgcViz
library(mgcViz)
?mgcViz
gam_viz = getViz(gam_mod)
plot(gam_viz, select=4)+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=5)+
l_fitLine(colour = cbp1[5]) + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = cbp1[3], linetype = 2) +
l_points(shape = 19, size = 1, alpha = 0.1) + theme_classic()
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=5)+
l_fitLine(colour = cbp1[5]) + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = cbp1[3], linetype = 2) +  theme_classic()
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=4)+
l_fitLine(colour = cbp1[5]) + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = cbp1[3], linetype = 2) +  theme_classic()
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=4)+theme_classic(base_size=20)
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=16)+theme_classic(base_size=20)
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=10)+theme_classic(base_size=20)
gam_plot1
# which plots to highlight?
gam_plot1 = plot(sm(gam_mod), 1)+theme_classic(base_size=20)+
l_fitLine(colour = "red") + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = "blue", linetype = 2) +
l_points(shape = 19, size = 1, alpha = 0.1)
# which plots to highlight?
gam_plot1 = plot(sm(gam_viz), 1)+theme_classic(base_size=20)+
l_fitLine(colour = "red") + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = "blue", linetype = 2) +
l_points(shape = 19, size = 1, alpha = 0.1)
# which plots to highlight?
gam_plot1 = plot(sm(gam_viz, 3))+theme_classic(base_size=20)+
l_fitLine(colour = "red") + l_rug(mapping = aes(x=x, y=y), alpha = 0.8) +
l_ciLine(mul = 5, colour = "blue", linetype = 2) +
l_points(shape = 19, size = 1, alpha = 0.1)
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_points()
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_ciline(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[6])+l_fitContour(color=cbp1[3])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[6])+l_fitLine(color=cbp1[3])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=5)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=4)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=3)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot2 = plot(gam_viz, select=21)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot2+theme_classic()
gam_plot2 = plot(gam_viz, select=26)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot2+theme_classic()
gam_plot4 = plot(gam_viz, select=31)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
gam_plot4 = plot(gam_viz, select=34)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
gam_plot4 = plot(gam_viz, select=35)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
gam_plot4 = plot(gam_viz, select=36)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
gam_plot4 = plot(gam_viz, select=32)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
gam_plot4 = plot(gam_viz, select=36)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot4+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=3)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=8)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=9)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=10)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=11)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=9)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=8)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
gam_plot1 = plot(gam_viz, select=7)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=3)+l_ciLine(color=cbp1[3])+l_fitLine(color=cbp1[6])
gam_plot1+theme_classic()+scale_x_discrete(limits=1:12)
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)
gam_plot1
gam_plot2 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)
gam_plot2
gam_plot3 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)
gam_plot3
gam_plot4 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)
gam_plot4
summary(gam_mod)
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab()
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ggtitle('Smooth function for month for age 30-34')
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ggtitle('Month smooth for age 30-34')
gam_plot1
gam_plot2 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
#ylab('s(month):30_34')+
ggtitle('Month smooth for age 75-79')
gam_plot2
gam_plot2 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):75_79')+
ggtitle('Month smooth for age 75-79')
gam_plot2
plot(gam_mod, select=26)
gam_plot3 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 35-39')+
ylab('s(year):35_39')
gam_plot3
gam_plot4 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 85-99')+
ylab('s(year):85_99')
gam_plot4
library(emmeans)
emmeans(gam_mod, spec='sex')
pairs(emmeans(gam_mod, spec='sex'))
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ggtitle('Month smooth for age 30-34')
gam_plot1
ggsave('figs/gam_plot1.png',
plot=gam_plot1,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
gam_plot2 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):75_79')+
ggtitle('Month smooth for age 75-79')
gam_plot2
ggsave('figs/gam_plot2.png',
plot=gam_plot2,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
gam_plot3 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 35-39')+
ylab('s(year):35_39')
gam_plot3
ggsave('figs/gam_plot3.png',
plot=gam_plot3,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
gam_plot4 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 85-99')+
ylab('s(year):85_99')
gam_plot4
ggsave('figs/gam_plot4.png',
plot=gam_plot4,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
summary(gam_mod)
install.packages('cowplot')
library(cowplot) # save mgcViz plots to png
save_plot('figs/gam_plot1.png',
plot=gam_plot1,
units = fig.units,
width = fig.width,
height = fig.height,
dpi = fig.res)
save_plot('figs/gam_plot1.png',
plot=gam_plot1,
units = fig.units,
base_width = fig.width,
base_height = fig.height,
dpi = fig.res)
ggsave('figs/gam_plot1.png',
plot=gam_plot1,
units = fig.units,
base_width = fig.width,
base_height = fig.height)
ggsave('figs/gam_plot1.png',
plot=gam_plot1,
units = fig.units,
width = fig.width,
height = fig.height)
ggsave('figs/gam_plot1.png',
plot=gam_plot1)
gam_plot1
ggsave('figs/gam_plot1.png')
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ggtitle('Month smooth for age 30-34')
gam_plot1; ggsave('figs/gam_plot1.png')
gam_plot2 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):75_79')+
ggtitle('Month smooth for age 75-79')
gam_plot2; ggsave('figs/gam_plot2.png')
gam_plot3 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 35-39')+
ylab('s(year):35_39')
gam_plot3; ggsave('figs/gam_plot3.png')
gam_plot4 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 85-99')+
ylab('s(year):85_99')
gam_plot4; ggsave('figs/gam_plot4.png')
plot(gam_mod, select=25)
plot(gam_mod, select=8)
plot(gam_mod, select=26)
plot(gam_mod, select=1)
plot(gam_mod, select=2)
plot(gam_mod, select=3)
plot(gam_mod, select=4)
plot(gam_mod, select=6)
plot(gam_mod, select=8)
plot(gam_mod, select=7)
plot(gam_mod, select=10)
gam_plot1
gam_plot2
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ylim(c(-0.05, 0.05))
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ylim(c(-0.05, 0.05))+
ggtitle('Month smooth for age 30-34')
gam_plot1
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ylim(c(-0.1, 0.1))+
ggtitle('Month smooth for age 30-34')
gam_plot1
gam_plot3
gam_plot4
gam_plot11 = plot(gam_viz, select=1)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ylim(c(-0.05, 0.05))+
ggtitle('Month smooth for age 30-34')
gam_plot11
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=2)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
#ylab('s(month):30_34')+
ylim(c(-0.05, 0.05))+
ggtitle('Month smooth for age 5-9')
gam_plot1
plot(gam, select=19)
plot(gam_mod, select=19)
plot(gam_mod, select=20)
gam_plot4 = plot(gam_viz, select=20)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 5-9')+
ylab('s(year):05_09')
gam_plot4
gam_plot5 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 35-39')+
ylab('s(year):35_39')
gam_plot5
gam_plot6 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 85-99')+
ylab('s(year):85_99')
gam_plot6
plot(gam_mod, select=22)
plot(gam_mod, select=21)
# which plots to highlight?
gam_plot1 = plot(gam_viz, select=2)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):05_09')+
ylim(c(-0.05, 0.05))+
ggtitle('Month smooth for age 5-9')
gam_plot1; ggsave('figs/gam_plot1.png')
gam_plot2 = plot(gam_viz, select=7)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):30_34')+
ylim(c(-0.05, 0.05))+
ggtitle('Month smooth for age 30-34')
gam_plot2; ggsave('figs/gam_plot2.png')
gam_plot3 = plot(gam_viz, select=16)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
scale_x_discrete(limits=1:12)+
ylab('s(month):75_79')+
ggtitle('Month smooth for age 75-79')
gam_plot3; ggsave('figs/gam_plot3.png')
gam_plot4 = plot(gam_viz, select=20)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 5-9')+
ylab('s(year):05_09')
gam_plot4; ggsave('figs/gam_plot4.png')
gam_plot5 = plot(gam_viz, select=26)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 35-39')+
ylab('s(year):35_39')
gam_plot5; ggsave('figs/gam_plot5.png')
gam_plot6 = plot(gam_viz, select=36)+
l_ciLine(color=cbp1[3])+
l_fitLine(color=cbp1[6])+
theme_classic(base_size=18)+
ggtitle('Year smooth for age 85-99')+
ylab('s(year):85_99')
gam_plot6; ggsave('figs/gam_plot6.png')
